<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>PiAIZU: PiAIZU webserver</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="sonylogo.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PiAIZU
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">PiAIZU webserver </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="lmxindex.html">LMX interactive page</a></p>
<div class="fragment"><div class="line">Build date:</div><div class="line">Git describe:</div></div><!-- fragment --><h1><a class="anchor" id="intro_sec"></a>
Introduction</h1>
<p>You have now successfully connected to the Raspberry PIs webserver. This documentation has been compiled with Doxygen and will describe how to use this Raspberry PI to control the Sony LMX-001 display. This setup is called the PiAIZU.</p>
<p>When this PiAIZU is powered up it boots Linux (Raspbian lite) and an sample application is started. This app will display an animation in the LMX-001 and some basic information. The PiAIZU will also act as a WiFi access point and since you can read this document you have probably already successfully connected to it.</p>
<p>This setup has all the nescessary tools and compilers pre-installed to be able to both edit and recompile this sample application.</p>
<p>A few useful tools that has been added:</p><ul>
<li>GCC</li>
<li>Python</li>
<li>sshfs</li>
<li>gdb</li>
<li>gdb-server</li>
</ul>
<h2><a class="anchor" id="access"></a>
How to access the Raspberry</h2>
<p>The Raspberry Pi has a SSH server running and it has been configured with a static IP address that is 192.168.1.1 To connect to the Raspberry Pi via ssh:</p>
<p><b>In Linux</b></p>
<p>Open a terminal and type:</p>
<div class="fragment"><div class="line">ssh pi@192.168.1.1</div></div><!-- fragment --><p><b>In Windows</b></p>
<p>Download and install Putty and setup a SSH connection.</p>
<p><b>Password is: raspberry</b></p>
<h2><a class="anchor" id="about_sw"></a>
About the sample application</h2>
<p>The sample application and library provided with source code and resides in: </p><pre class="fragment">/home/pi/lmx_example
</pre><p>It basically starts with memory mapping the framebuffer: </p><pre class="fragment">/dev/fb0
</pre><p>and then a software layer is put over that to enable the user to specifiy layers or containers that the user then can put various kind of information in. This could be text, shapes like lines or dots, or fill the container with a bitmap image. Each container has x,y coordinate together with height and width. Each container can be set to be visible or hidden runtime.</p>
<p>To start working the framebuffer needs to be mapped to memory, memory has to be allocated for the containers and some initialisation has do be done, this is done by calling the function:</p>
<div class="fragment"><div class="line"><a class="code" href="container_8c.html#a744f004610e0afbb44f3dd05743cea16">container_new</a>()</div></div><!-- fragment --><p>In the first version the containers are statically defined before compile time. This is done in the file: <a class="el" href="define__containers_8h.html">define_containers.h</a> Every time a containers contents has been updated the whole container system needs to be compiled before the actual change is displayed on the screen. This is done by calling the funcion: </p><div class="fragment"><div class="line"><a class="code" href="container_8c.html#a1f44a225b43ddd4356ffc184bc66b6e2">container_compile</a>()</div></div><!-- fragment --><p> To close the system the funcion </p><div class="fragment"><div class="line"><a class="code" href="container_8c.html#a34b18ff42f14b31ed2cf2863e785ed97">container_close</a>()</div></div><!-- fragment --><p> must be called to free all the allocated memory and to unmap the framebuffer. Similar approach has been used in the text/font system regarding init and close.</p>
<p>There are various function to add or manipulate the contents of the containers. The handle for each container is basically an integer that is an index that points out which container it is in the array or <a class="el" href="structcontainer__t.html">container_t</a> in <a class="el" href="define__containers_8h.html">define_containers.h</a>.</p>
<p>Functions to decode .bmp files has been implemented and tested on both 24 bit and 32 bit bmp files. The difference is basically that in the 32 bit case you have RGBA and in 24 bit it's only RGB information stored The 'A' in RGBA is not being used at the moment.</p>
<p>A simple font has been added that supports uppercase and lower case letters together with numbers and only a few special characters.</p>
<h2><a class="anchor" id="buttons_sec"></a>
Buttons</h2>
<p>The shield connected to the Raspberry has two small button, a lib has been written to be able to register events from these buttons. Try to click the buttons while running the sample application to see, for events has been registered that will be trigged depending on how long each key press is and on what button.</p>
<h2><a class="anchor" id="web_interface"></a>
Webinterface</h2>
<p>The sample application has an interface to be able to receive commands from the web. To evaluate this functionality enter <a href="lmxindex.html">LMX interactive page</a>. From here it is possible to send text and show a cross-hair cursor directly on the LMX-001 display.</p>
<p>This functionality works like this:</p>
<p>The web server (lighttpd) shows the <a href="lmxindex.html">LMX interactive page</a>. When a button is clicked, a cgi script is called. The source code of this script is available in the sample applicationlication folder under /hopme/pi/lmx_example/cgi-src. This cgi script will via a UNIX socket in /tmp/lmx.socket connect to the LMX sample application. The sample application can also reply with data.</p>
<h1><a class="anchor" id="install_sec"></a>
Compilation</h1>
<p>The application consist of a library and two sample applicationlications. One written in C and one written in Python, they are called <a class="el" href="main_8c.html">main.c</a> and main.py. Both the <a class="el" href="main_8c.html">main.c</a> and main.py use the provided library. The whole buildsystem can be configured by changing the settings in settings.mk. For development it can be convenient to to set the flag </p><div class="fragment"><div class="line">LDEXTRA=-Wl,-rpath,./lib/</div></div><!-- fragment --><p> to tell the linker to use the locally built liblmx.so instead of the pre-installed one. This is done in settings.mk.</p>
<p>The Makefile contains a few targets:</p><ul>
<li><b>all</b> Will build the sample application</li>
<li><b>clean</b> Will remove all build files, binaries, object files. Compiled documentation is not affected</li>
<li><b>format</b> Runs clang-format on all source, this requires clang-format to be installed which it isn't on the Raspberry</li>
<li><b>install</b> Installs the lmx binary into /usr/bin and activates startup scripts in init.d</li>
<li><b>dbg</b> Compiles the all with extra prints for debugging, forces a frame to be printed around all containers</li>
<li><b>doc</b> Will run Doxygen to recompile this documentation, requires Doxygen to be installed</li>
<li><p class="startli"><b>analyze</b> Runs scan-build to perform a static code analysis</p>
<p class="startli">It is possible to run this program on a Linux computer too. Then the sample applicationlication will use the PC:s framebuffer. On Ubuntu you will have to press Ctrl+Alt+F1 to get into a console. From there you can start the sample application and you will see the same output as if the program was used on the PiAIZU. Example app must first be recompiled for the x86 architecture for that to work, that is a matter of rebuilding it but doing that on the host computer.</p>
</li>
</ul>
<p>To simply rebuild the sample application, type: </p><div class="fragment"><div class="line">make</div></div><!-- fragment --><p>to install your changes on the Raspberry Pi rootfs: </p><div class="fragment"><div class="line">sudo make install</div></div><!-- fragment --><p>There are a few buildflags that can be added to get special functions:</p>
<p>The following buildflag will mask out red and blue color, this is usefull when testing the software on a PC to get a picture more similar to the one in LMX-001. </p><div class="fragment"><div class="line">SETTING+=-DGREEN_MONOCHROME</div></div><!-- fragment --><p>To convert a RGB BMP to green scale two methods are implemented, Average and Luminosity. To activate try one of the following: </p><div class="fragment"><div class="line">SETTING+=-DGRAYSCALE_LUMINOSITY</div><div class="line">SETTING+=-DGRAYSCALE_AVERAGE</div></div><!-- fragment --><h1><a class="anchor" id="rebuild_sec"></a>
Rebuilding Raspbian</h1>
<p>To update or add new packages to the Raspbian rootfs you either have to provide Internet to the Raspberry Pi or recompile the whole Raspbian.</p>
<p>The modified Raspbian buildsystem is provided on the PiAIZU SD card image, it resides under: </p><div class="fragment"><div class="line">/home/pi/piaizu_<span class="stringliteral">&quot;v2.0.0&quot;</span></div></div><!-- fragment --><p> the postfix is the git describe &ndash;tags output. In this directory you will find more information on how to rebuild the SD card image.</p>
<p>Second option is to provide a Internet connection If you have two network connections on your PC you could most probably share your one Internet connection with while your WLAN is connected to the Raspberry Pi AP PiAIZU. To do that successfully you need to enable ip forwarding and setup your iptables for NAT. The Internet is full information on how to do this.</p>
<h1><a class="anchor" id="changelog_sec"></a>
Change log</h1>
<dl class="section version"><dt>Version</dt><dd>v2.1.0<ul>
<li>Minor changes to the container api</li>
<li>Added python sample application</li>
<li>Created a lib, (liblmx.so) of almost all sample application, leaving only <a class="el" href="main_8c.html">main.c</a> outside </li>
</ul>
</dd>
<dd>
v2.0.0<ul>
<li>New webinterface </li>
</ul>
</dd>
<dd>
v1.0.0<ul>
<li>First release </li>
</ul>
</dd></dl>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
